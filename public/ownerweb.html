<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Owner Dashboard | RentHub</title>
<style>
body{font-family:'Poppins',sans-serif;margin:0; background:linear-gradient(135deg,#020617,#0f172a); color:#fff;}
header{padding:22px; display:flex; justify-content:space-between; background:rgba(0,0,0,0.4); backdrop-filter:blur(10px);}
.container{padding:25px; max-width:1200px; margin:auto;}
input,select,button{padding:10px;margin-bottom:10px;border-radius:10px;border:none;}
.items, #requests{margin-top:15px;}
.card{background:rgba(255,255,255,0.08); padding:15px; border-radius:15px;}
.request{background:rgba(0,0,0,0.35); padding:15px;border-radius:15px;margin-bottom:10px;}
</style>
</head>
<body>

<header>
<h1>Owner Dashboard</h1>
<div>Welcome, <b id="ownerName"></b></div>
<button onclick="logout()">Logout</button>
</header>

<div class="container">
<h3>Add Rental Item</h3>
<input id="shop_name" placeholder="Shop Name">
<input id="item_name" placeholder="Item Name">
<select id="category"><option>Electronics</option><option>Bike</option><option>Car</option><option>Tent</option><option>Appliance</option></select>
<input id="price_per_day" placeholder="Price per day">
<input id="location" placeholder="Location">
<button onclick="addItem()">Add Item</button>

<h3>Booking Requests</h3>
<div id="requests"></div>
</div>

<script>
const ownerId = localStorage.getItem("owner_id");
if(!ownerId){ alert("Login first"); window.location="index.html"; }
document.getElementById("ownerName").innerText=localStorage.getItem("name")||"Owner";

function logout(){localStorage.clear(); window.location="index.html";}

function addItem(){
  const data={
    shop_name:document.getElementById("shop_name").value.trim(),
    item_name:document.getElementById("item_name").value.trim(),
    category:document.getElementById("category").value,
    price_per_day:document.getElementById("price_per_day").value,
    location:document.getElementById("location").value.trim(),
    owner_id:ownerId
  };
  if(Object.values(data).some(v=>!v)) return alert("Fill all fields");
  fetch("/api/items",{method:"POST", headers:{"Content-Type":"application/json"}, body:JSON.stringify({...data, action:"addItem"})})
  .then(r=>r.json()).then(d=>{ if(d.success){ alert("Item added"); loadRequests(); } else alert(d.message); }).catch(()=>alert("Server error"));
}

function loadRequests(){
  fetch("/api/requests",{method:"POST", headers:{"Content-Type":"application/json"}, body:JSON.stringify({owner_id:ownerId})})
  .then(r=>r.json()).then(d=>{
    const box=document.getElementById("requests"); box.innerHTML="";
    if(!d.success || d.requests.length===0){ box.innerHTML="<p>No requests yet</p>"; return; }
    d.requests.forEach(rq=>{
      box.innerHTML+=`<div class="request"><b>${rq.customer_name}</b> wants <b>${rq.item_name}</b> for ${rq.rental_duration} days <button onclick="respond(${rq.request_id},'accepted')">Accept</button> <button onclick="respond(${rq.request_id},'rejected')">Reject</button></div>`;
    });
  });
}

function respond(request_id,status){
  fetch("/api/respond-request",{method:"POST", headers:{"Content-Type":"application/json"}, body:JSON.stringify({request_id,status})})
  .then(r=>r.json()).then(d=>{ if(d.success){ loadRequests(); } else alert(d.message); });
}

loadRequests();
</script>

</body>
</html>
