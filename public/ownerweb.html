<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Owner Dashboard | RentHub</title>

<style>
body{
  font-family:'Poppins',sans-serif;
  margin:0;
  background:linear-gradient(135deg,#020617,#0f172a);
  color:#fff;
}
header{
  padding:22px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  background:rgba(0,0,0,0.4);
  backdrop-filter:blur(10px);
}
.container{
  padding:25px;
  max-width:1200px;
  margin:auto;
}
input,select,button{
  padding:10px;
  margin-bottom:10px;
  border-radius:10px;
  border:none;
}
button{
  cursor:pointer;
  background:#38bdf8;
  font-weight:600;
}
button:hover{ background:#0ea5e9; }
.card,.request{
  background:rgba(255,255,255,0.08);
  padding:15px;
  border-radius:15px;
  margin-bottom:12px;
}
.accept{ background:#22c55e; }
.reject{ background:#ef4444; margin-left:8px; }
</style>
</head>

<body>

<header>
  <h2>Owner Dashboard</h2>
  <div>Welcome, <b id="ownerName"></b></div>
  <button onclick="logout()">Logout</button>
</header>

<div class="container">

  <h3>Add Rental Item</h3>
  <input id="shop_name" placeholder="Shop Name">
  <input id="item_name" placeholder="Item Name">

  <select id="category">
    <option value="">Select Category</option>
    <option>Electronics</option>
    <option>Bike</option>
    <option>Car</option>
    <option>Tent</option>
    <option>Appliance</option>
  </select>

  <input id="price_per_day" type="number" placeholder="Price per day">
  <input id="location" placeholder="Location">

  <button onclick="addItem()">Add Item</button>

  <h3>Booking Requests</h3>
  <div id="requests"></div>

</div>

<script>
/* ---------- AUTH ---------- */
const ownerId = localStorage.getItem("owner_id");
if(!ownerId){
  alert("Please login first");
  window.location.href="index.html";
}
document.getElementById("ownerName").innerText =
  localStorage.getItem("name") || "Owner";

function logout(){
  localStorage.clear();
  window.location.href="index.html";
}

/* ---------- ADD ITEM ---------- */
async function addItem(){
  const data = {
    action:"addItem",
    owner_id: ownerId,
    shop_name: shop_name.value.trim(),
    item_name: item_name.value.trim(),
    category: category.value,
    price_per_day: price_per_day.value,
    location: location.value.trim()
  };

  if(Object.values(data).some(v=>!v)){
    alert("Fill all fields");
    return;
  }

  try{
    const res = await fetch("/api/items",{
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body:JSON.stringify(data)
    });
    const d = await res.json();
    if(d.success){
      alert("âœ… Item added");
      loadRequests();
    }else{
      alert(d.message || "Failed");
    }
  }catch(err){
    alert("Server error");
  }
}

/* ---------- LOAD BOOKING REQUESTS ---------- */
async function loadRequests(){
  try{
    const res = await fetch(`/api/create-request?owner_id=${ownerId}`);
    const d = await res.json();

    const box = document.getElementById("requests");
    box.innerHTML="";

    if(!d.success || d.requests.length===0){
      box.innerHTML="<p>No booking requests</p>";
      return;
    }

    d.requests.forEach(r=>{
      box.innerHTML += `
        <div class="request">
          <b>${r.customer_name}</b> wants <b>${r.item_name}</b><br>
          Days: ${r.rental_duration}<br>
          Phone: ${r.phone}<br>
          Aadhaar: ${r.aadhaar}<br>
          Status: <b>${r.status}</b><br><br>

          ${
            r.status==="Pending" ? `
              <button class="accept"
                onclick="respond(${r.request_id},'Accepted')">Accept</button>
              <button class="reject"
                onclick="respond(${r.request_id},'Rejected')">Reject</button>
            ` : ""
          }
        </div>`;
    });

  }catch(err){
    alert("Failed to load requests");
  }
}

/* ---------- ACCEPT / REJECT ---------- */
async function respond(request_id,status){
  try{
    const res = await fetch("/api/create-request",{
      method:"PUT",
      headers:{ "Content-Type":"application/json" },
      body:JSON.stringify({ request_id, status })
    });
    const d = await res.json();
    if(d.success){
      loadRequests();
    }else{
      alert(d.message || "Action failed");
    }
  }catch(err){
    alert("Server error");
  }
}

loadRequests();
</script>

</body>
</html>
