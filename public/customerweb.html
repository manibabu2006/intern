<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Customer Dashboard | RentHub</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin: 0;
  font-family: 'Segoe UI', sans-serif;
  background: linear-gradient(120deg, #0f2027, #203a43, #2c5364);
  color: #fff;
}
header {
  padding: 20px;
  font-size: 24px;
  font-weight: bold;
}
.container { padding: 20px; }

select {
  width: 100%;
  padding: 12px;
  margin: 10px 0;
  border-radius: 8px;
  border: none;
}

.categories, .items {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
  gap: 15px;
}

.card {
  background: #1e293b;
  padding: 20px;
  border-radius: 15px;
  cursor: pointer;
  transition: 0.3s;
  text-align: center;
}
.card:hover { transform: scale(1.05); background:#334155; }

button {
  padding: 10px 15px;
  border: none;
  border-radius: 8px;
  background: #22c55e;
  color: #000;
  font-weight: bold;
  cursor: pointer;
}
button:disabled { background: gray; }

.modal {
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.7);
  justify-content:center;
  align-items:center;
}
.modal-content {
  background:#0f172a;
  padding:25px;
  border-radius:15px;
  width:90%;
  max-width:400px;
}
</style>
</head>

<body>

<header>ğŸš€ RentHub â€“ Customer Dashboard</header>
<header>
  <h2>Rentzy | Customer</h2>
  <button onclick="logout()">Logout</button>
</header>


<div class="container">

<h3>Select Location</h3>
<select id="location">
  <option value="">Choose location</option>
  <option value="Hyderabad">Hyderabad</option>
  <option value="Bangalore">Bangalore</option>
</select>

<h3>Select Category</h3>
<div class="categories">
  <div class="card" onclick="loadItems('Electronics')">ğŸ’» Electronics</div>
  <div class="card" onclick="loadItems('Bike')">ğŸ Bikes</div>
  <div class="card" onclick="loadItems('Car')">ğŸš— Cars</div>
  <div class="card" onclick="loadItems('Tent')">ğŸ• Tents</div>
  <div class="card" onclick="loadItems('Appliance')">ğŸ  Appliances</div>
</div>

<h3>Available Items</h3>
<div class="items" id="items"></div>

</div>

<!-- Booking Modal -->
<div class="modal" id="bookingModal">
  <div class="modal-content">
    <h3>Confirm Booking</h3>
    <label>
      <input type="checkbox" id="terms"> I accept terms & conditions
    </label><br><br>
    <button id="confirmBtn" disabled onclick="confirmBooking()">Book Now</button>
  </div>
</div>

<script>
const customerId = localStorage.getItem("user_id");
let selectedItem = null;
if (!localStorage.getItem("user_id")) {
  window.location.replace("index.html");
}

document.getElementById("terms").addEventListener("change", e=>{
  document.getElementById("confirmBtn").disabled = !e.target.checked;
});

function loadItems(category){
  const location = document.getElementById("location").value;
  if(!location) return alert("Select location first");

  fetch(`/api/get-items?category=${category}&location=${location}`)
    .then(res=>res.json())
    .then(data=>{
      const box = document.getElementById("items");
      box.innerHTML='';
      data.forEach(i=>{
        box.innerHTML+=`
        <div class="card">
          <h4>${i.item_name}</h4>
          <p>â‚¹${i.price}/day</p>
          <p>${i.shop_name}</p>
          <button onclick="openBooking(${i.id})">Book Now</button>
        </div>`;
      });
    });
}

function openBooking(id){
  selectedItem = id;
  document.getElementById("bookingModal").style.display='flex';
}

function confirmBooking(){
  fetch('/api/create-request',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({ item_id:selectedItem, customer_id:customerId })
  }).then(()=>alert("Booking request sent"));
}

function logout() {
  localStorage.removeItem("user_id");
  localStorage.removeItem("role");
  localStorage.removeItem("name");

  // Prevent back navigation
  window.location.replace("index.html");
}
</script>

</body>
</html>
